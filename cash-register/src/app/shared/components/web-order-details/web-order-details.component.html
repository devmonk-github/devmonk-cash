<div class="card shadow-sm">
    <div class="card-header" style="margin-top: 20px;">
        <h4>{{ 'WEB_ORDER_DETAILS' | translate}}</h4>
        <div mat-dialog-actions>
            <button mat-dialog-close type="button" class="btn btn-sm btn-light" (click)="close(false)">
                <fa-icon [icon]="faTimes"></fa-icon>
            </button>
        </div>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-3">
                <h3>{{activity.sNumber}}</h3>
                <div class="d-flex flex-wrap py-5 border">
                    <div class="flex-equal me-5">
                        Customer Details
                        <div class="fs-6 ms-1">
                            <div class="align-items-center">
                                <div class="text-gray-600">{{customer?.sFirstName || ''}} {{customer?.sLastName || ''}}
                                </div>
                            </div>
                        </div>
                        <div class="fs-6 ms-1">
                            <div class="align-items-center">
                                <div class="text-gray-600">{{customer?.sEmail || ''}}<a
                                        href="mailto:{{customer?.sEmail}}">
                                        <fa-icon [icon]="faEnvelope"></fa-icon>
                                    </a></div>
                            </div>
                        </div>
                        <div class="fs-6 ms-1">
                            <div class="align-items-center">
                                {{'PHONE_MOBILE' | translate}}
                                <span>{{customer?.oPhone?.sMobile}}
                                    <i class="fab fa-whatsapp ms-1" *ngIf="customer?.oPhone?.bWhatsApp"
                                        style="color: #1CB39B;"></i>
                                </span>
                            </div>
                        </div>
                        <div class="fs-6 ms-1">
                            <div class="align-items-center">
                                {{'PHONE_LANDLINE' | translate}}
                                <span>{{customer?.oPhone?.sLandLine}}
                                </span>
                            </div>
                        </div>

                        <div class="fs-6 ms-1">
                            <div class="align-items-center">
                                {{'Advised by' | translate}}
                                <span>{{customer?.oPhone?.sLandLine}}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-8 row">
                <h3 class="fw-bolder mb-4">
                    <span>{{ "OVERVIEW" | translate }}</span>
                </h3>
                <div class="col-md-8 row fw-bold gy-1">
                    <div class="col-md-12">
                        <select name="status" id="status" class="form-select" [(ngModel)]="activity.eRepairStatus" placeholder="Order status" (ngModelChange)="changeStatusForAll(activity.eRepairStatus)">
                            <option *ngFor="let type of repairStatus" [value]="type">{{type}}</option>
                        </select>
                    </div>
                    <label class="col-md-4 mt-5 text-muted">{{"SHIPPING_METHOD" | translate}} : </label>
                    <div class="col-md-8 mt-5">
                        <div class="text-gray-800">Completed</div>
                    </div>
                    <label class="col-md-4 mt-5 text-muted">{{"CARRIER" | translate}} : </label>
                    <div class="col-md-8 mt-5">
                        <select name="carrier" id="carrier" class="form-select" [(ngModel)]="activity.eCarrier" placeholder="carrier" (ngModelChange)="changeCarrierForAll(activity.eCarrier)">
                            <option *ngFor="let carrier of carriers" [value]="carrier">{{carrier}}</option>
                        </select>
                    </div>
                    <input type="text" name="activityName" [(ngModel)]="activity.sTrackingNumber" placeholder="Track and trace the order" class="form-control" (ngModelChange)="changeTrackingNumberForAll(activity.sTrackingNumber)">
                </div>
                <div class="col-md-4">
                    <button class="btn btn-sm btn-secondary w-100 d-flex">
                        <fa-icon [icon]="faDownload"></fa-icon>
                        <label class="mx-auto">Receipt</label>
                    </button>
                    <button class="btn btn-sm btn-secondary w-100 d-flex">
                        <fa-icon [icon]="faReceipt"></fa-icon>
                        <label class="mx-auto">Print thermal</label>
                    </button>
                    <button class="btn btn-sm btn-secondary w-100 d-flex">
                        <label class="mx-auto">Exchange</label>
                    </button>
                    <button class="btn btn-sm btn-secondary w-100 d-flex" (click)="downloadOrder()">
                        <fa-icon [icon]="faDownload"></fa-icon>
                        <label class="mx-auto">Download pdf</label>
                    </button>
                    <button class="btn btn-sm btn-primary w-100 d-flex mt-5">
                        <label class="mx-auto">Sent to customer</label>
                    </button>
                    <button class="btn btn-sm btn-secondary w-100 d-flex">
                        <label class="mx-auto">Ready to pick up</label>
                    </button>
                    <button class="btn btn-sm btn-secondary w-100 d-flex">
                        <label class="mx-auto">Deliver</label>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body row">
        <div class="col-md-12">
            <h3 class="fw-bolder mb-3">
                <span>{{ "ITEMS" | translate }}</span>
            </h3>
            <div class="row fw-bold gy-1 d-flex flex-wrap py-5">
                <div class="flex-equal me-5">
                    <table class="table table-hover table-rounded table-striped border gy-7 gs-7">
                        <thead>
                            <tr class="fw-bold fs-6 text-gray-400">
                                <td class="text-muted">{{'IMAGE' | translate}}</td>
                                <td class="text-muted">{{'PRODUCT' | translate}}</td>
                                <td class="text-muted">{{'STATUS' | translate}}</td>
                                <td class="text-muted">{{'CUSTOMER' | translate}}</td>
                                <td class="text-muted">{{'PRICE' | translate}}</td>
                                <td class="text-muted">{{'QUANTITY' | translate}}</td>
                                <td class="text-muted">{{'DISCOUNT_PER_ITEM' | translate}}</td>
                                <td class="text-muted">{{'TAX' | translate}}</td>
                                <td class="text-muted">{{'TOTAL_PRICE' | translate}}</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of transactions; let i = index">
                                <td>
                                    <img src="{{ item?.aImage?.length > 0 ? item.aImage[0] : imagePlaceHolder}}"
                                        (error)="item.aImage[0]=imagePlaceHolder" class="product_image">
                                </td>
                                <td>
                                    <div>
                                        {{item.sProductName}}
                                    </div>
                                    <br>
                                    <div *ngIf="item?.aProductVariant?.length > 0">
                                        <div *ngFor="let variant of item.aProductVariant" class="d-flex">
                                            <div class="w-25">
                                                {{ variant.sVariantBase }}
                                            </div> :
                                            <div class="w-50 px-2">
                                                <span *ngIf="variant.sVariantBase !== 'color'"> {{ variant.value }}
                                                </span>
                                                <span *ngIf="variant.sVariantBase === 'color'"
                                                    [style.background]="variant.value"
                                                    class="px-2 border border-gray-600"></span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td *ngIf="!item.bRefund">
                                    <select name="status" id="status" class="form-select" [(ngModel)]="item.eRepairStatus" (ngModelChange)="updateActivityItem(item)">
                                        <option *ngFor="let type of repairStatus" [value]="type">{{type}}</option>
                                    </select>
                                </td>
                                <td *ngIf="item.bRefund"></td>
                                <td>{{item.nPriceIncVat}}</td>
                                <td>{{item?.customer?.sFirstName}} {{item?.customer?.sLastName}}</td>
                                <td>
                                    <div class="d-flex align-items-stretch flex-shrink-0 me-sm-2">
                                        {{item.nQuantity}}
                                    </div>
                                    <div class="d-flex align-items-stretch flex-shrink-0 me-sm-2"
                                        *ngIf="showDetails && userDetail && item.iBusinessProductId">
                                        <div class="cursor-pointer my-auto fs-5 fw-bolder text-gray-700 show menu-dropdown"
                                            data-kt-menu-trigger="click" data-kt-menu-attach="parent"
                                            data-kt-menu-placement="bottom-start" data-kt-menu-flip="bottom">
                                            <label class="fs-5 form-label fw-bolder text-dark">Location : </label>
                                            <span *ngIf="item">( {{item.locationName || 'Unknown'}} )</span>
                                        </div>
                                        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg menu-state-primary fw-bold py-4 fs-6 w-200px" data-kt-menu="true">
                                            <div *ngIf="business?.aInLocation?.length > 0" class="menu-item px-3"
                                                data-kt-menu-trigger="hover" data-kt-menu-placement="right-start">
                                                <div class="menu-item px-3 cursor-pointer" *ngFor="let location of business.aInLocation">
                                                    <a class="menu-link d-flex px-5"
                                                        (click)="selectBusiness(i, location)">
                                                        {{ location.sName }}
                                                    </a>
                                                </div>
                                            </div>
                                            <div *ngIf="business?.aInLocation?.length == 0" class="menu-item px-3">
                                                <span class="menu-link d-flex" (click)="selectBusiness(i)">
                                                    {{ business.sName || 'Unknown'}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>0</td>
                                <td>{{item.nVatRate || 0}}</td>
                                <td>{{item.nPriceIncVat || 0}}</td>
                            </tr>
                            <tr *ngIf='transactions.length'>
                                <td>{{'TOTAL' | translate}}</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>{{quantity}}</td>
                                <td></td>
                                <td></td>
                                <td>{{totalPrice}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="d-flex">
                <h5 *ngIf='!transactions.length && !loading' style="text-align: center">{{'NO_DATA_FOUND' | translate }}
                </h5>
                <div *ngIf="loading" class="spinner-border mx-auto"></div>
            </div>
        </div>
    </div>
    <div class="card-footer">
        <button class="btn btn-primary" (click)="submit()" type="submit">Submit</button>
    </div>
</div>