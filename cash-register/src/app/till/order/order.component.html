<h2 class="accordion-header">
  <button class="accordion-button fs-4 fw-bold" type="button" data-bs-toggle="collapse"
    data-bs-target="#kt_accordion_1_body_1" aria-expanded="true" aria-controls="kt_accordion_1_body_1">
    <section class="d-flex product-row align-items-center">
      <div class="w-90px"><svg width="15" height="15" class="m-1">
          <rect width="15" height="15" style="fill:{{getColorCode(item)}}; stroke-width:1 ;stroke:rgb(0,0,0)" />
          Sorry, your browser does not support inline SVG.
        </svg>{{item.quantity}}</div>
      <div class="w-275px">{{item.name}}</div>
      <div class="w-100px">{{item.price | currency: '€'}}</div>
      <div class="w-95px">{{item.nDiscount | currency: '€'}}</div>
      <div class="w-100px">{{item.tax}}%</div>
      <!-- <div class="w-100px">{{getTotalPrice(item)}}</div> -->
      <div class="w-100px">{{(item.price - item.nDiscount) * item.quantity | currency: '€' }}
      </div>
      <div class="w-75px">{{item.paymentAmount | currency: '€'}}</div>
    </section>
  </button>
</h2>
<div id="kt_accordion_1_body_1" class="accordion-collapse collapse show" aria-labelledby="kt_accordion_1_header_1"
  data-bs-parent="#kt_accordion_1">
  <div class="accordion-body px-3 py-4">
    <section class="d-flex product-row mb-3 row">
      <div class="col-1">
        <app-dialer [(quantity)]="item.quantity"></app-dialer>
        <div class="d-flex">
          <select name="taxRate" id="taxRate" class="form-select" [(ngModel)]="item.eTransactionItemType">
            <option *ngFor="let type of typeArray" [ngValue]="type">{{type}}</option>
          </select>
        </div>
        <div class="d-flex mt-3" *ngIf="item.eTransactionItemType === 'return'">
          <span class="fs-7 w-100 d-block text-gray-600 mb-1">Broken:</span>
          <input type="number" name="bagNumber" id="bagNumber" [(ngModel)]="item.nBrokenProduct" class="form-control"
            (change)="changeInbrokenAmount(item)">
        </div>
      </div>
      <div class="col-3">
        <div class="row my-3">
          <div class="col-12">
            <label for="description">{{ "Name" | translate }}</label>
          </div>
          <div class="col-12">
            <input type="text" [(ngModel)]="item.name" class="form-control" />
          </div>
        </div>
        <div class="row my-3">
          <div class="col-12">
            <label for="description">{{ "DESCRIPTION" | translate }}</label>
          </div>
          <div class="col-12">
            <textarea class="form-control" name="description" placeholder="{{ 'DESCRIPTION' | translate }}" lines="10"
              [(ngModel)]="item.description"></textarea>
          </div>
        </div>

        <div class="row my-3">
          <button (click)="bShowServicePartnerRemark = !bShowServicePartnerRemark" type="button"
            class="btn btn-outline-primary fs-6 p-2 ">
            {{bShowServicePartnerRemark?'Hide service partner remark':'Show service partner remark'}}
          </button>
          <ng-container *ngIf="bShowServicePartnerRemark">
            <textarea class="form-control" name="REMARK_FOR_SERVICE_PARTNERS"
              placeholder="{{ 'REMARK_FOR_SERVICE_PARTNERS' | translate }}" lines="10"
              [(ngModel)]="sServicePartnerRemark"></textarea>
          </ng-container>
        </div>


      </div>
      <div class="col-2">

        <div class="row my-3">
          <div class="col-12">
            <label for="bagNumber">{{ "BAG_NUMBER" | translate }}</label>
          </div>
          <div class="col-12">
            <input type="text" name="bagNumber" id="bagNumber" [(ngModel)]="item.sBagNumber" class="form-control" />
          </div>
        </div>

        <label for="price">{{ "PRICE" | translate}}</label>
        <input type="number" (change)="updatePayments(); changeInMargin()" name="price" class="form-control"
          [(ngModel)]="item.price" [disabled]="item.oType?.bRefund || item.tType === 'pay'">
        <button class="btn btn-bg-light btn-active-color-primary mt-2" type="button" data-bs-toggle="collapse"
          (click)="collapsedBtn = !collapsedBtn" [ngClass]="{'collapsed': collapsedBtn }"
          data-bs-target="#kt_accordion_123" aria-expanded="true" aria-controls="kt_accordion_123">
          More
          <fa-icon *ngIf="!collapsedBtn" [icon]="faArrowDown"></fa-icon>
          <fa-icon *ngIf="collapsedBtn" [icon]="faArrowUp"></fa-icon>
        </button>
        <div id="kt_accordion_123" [ngClass]="{'show': collapsedBtn }" class="accordion-collapse collapse">
          <label for="discount">{{ "MARGIN" | translate}}</label>
          <input type="number" step="any" (keyup)="changeInMargin()" name="discount" class="form-control"
            [(ngModel)]="item.nMargin" [disabled]="item.oType.bRefund || item.oType.bPrepayment">
          <label for="discount">{{ "PURCHASE_PRICE" | translate}}</label>
          <input type="number" step="any" (keyup)="changeInPurchasePrice()" name="discount" class="form-control"
            [(ngModel)]="item.nPurchasePrice" [disabled]="item.oType.bRefund || item.oType.bPrepayment">
        </div>
        <div id="kt_accordion_1234" [ngClass]="{'show': collapsedBtn }" class="accordion-collapse collapse">
          <label for="discount">{{ "DISCOUNT" | translate}}</label>
          <input *ngIf="!item.oType.bRefund && !item.oType.bDiscount && !item.oType.bPrepayment" type="number"
            step="any" name="discount" class="form-control" [(ngModel)]="item.nDiscount">
          <input *ngIf="item.oType.bRefund || item.oType.bDiscount|| item.oType.bPrepayment" type="number" step="any"
            name="discount" class="form-control" [value]="item.nDiscount - (item.nRedeemedLoyaltyPoints || 0)" disabled>
          <label for="discount" *ngIf="item.oType.bRefund">{{ "LOYALTY_POINTS" | translate}}:
            {{item.nRedeemedLoyaltyPoints}}</label>
          <label for="bagNumber">{{ "PREPAYMENT" | translate}}</label>
          <input type="number" name="bagNumber" id="bagNumber" [(ngModel)]="item.paymentAmount" class="form-control">
        </div>
      </div>

      <div class="col-2">

        <label for="taxRate">{{ "TAX" | translate}}</label>
        <select name="taxRate" id="taxRate" class="form-select" [(ngModel)]="item.tax">
          <option *ngFor="let rate of taxes" [ngValue]="rate.rate">{{rate.name}}</option>
        </select>
        <div class="row my-3">
          <div class="btn-group" role="group" aria-label="Basic example">
            <button (click)="contactType='phone'" [ngClass]="{active:contactType==='phone'}" type="button"
              class="btn btn-primary fs-6 p-2">
              <fa-icon [icon]="faPhone"></fa-icon>
            </button>
            <button (click)="contactType='email'" [ngClass]="{active:contactType==='email'}" type="button"
              class="btn btn-primary fs-6 p-2">
              <fa-icon [icon]="faAt"></fa-icon>
            </button>
            <button (click)="contactType='whatsapp'" [ngClass]="{active:contactType==='whatsapp'}" type="button"
              class="btn btn-primary fs-6 p-2">
              <i class="bi bi-whatsapp"></i>
            </button>
          </div>
        </div>

        <button class="btn btn-bg-light btn-active-color-primary mt-2" (click)="openImageModal()"> Photos
          <fa-icon [icon]="faUpload"></fa-icon>
        </button>
      </div>
      <div class="col-2">
        <label for="supplier">{{ "SUPPLIER" | translate}}</label>
        <ng-select *ngIf="!supplier" [(ngModel)]="supplier" (search)="searchSuppliers($event.term)"
          class="form-control form-control-solid p-0 w-100 custom" placeholder="Search repairer" [minTermLength]="2"
          [clearable]="false" [isOpen]="supplierOptions.length > 0"
          (change)="supplier = $event.sName; item.iSupplierId = $event._id; supplierOptions = []">
          <ng-option *ngFor="let option of supplierOptions" [value]="option">{{option.sName ||
            'Unknown'}}</ng-option>
        </ng-select>
        <div class="chip d-flex" *ngIf="supplier">
          {{supplier}}
          <div (click)="supplier=null">
            &nbsp;<i class="close fas fa-times cursor-pointer"></i>
          </div>
        </div>
        <label for="brand">{{ "BRAND" | translate}}</label>
        <ng-select *ngIf="!brand" [(ngModel)]="brand" (search)="searchBrands($event.term)"
          class="form-control form-control-solid p-0 w-100 custom" placeholder="Search brand" [minTermLength]="2"
          [clearable]="false" [isOpen]="filteredBrands.length > 0"
          (change)="brand = $event.sName; item.iBusinessBrandId = $event._id; filteredBrands = []">
          <ng-option *ngFor="let option of filteredBrands" [value]="option">{{option.sName ||
            'Unknown'}}</ng-option>
        </ng-select>
        <div class="chip d-flex" *ngIf="brand">
          {{brand}}
          <div (click)="brand=null">
            &nbsp;<i class="close fas fa-times cursor-pointer"></i>
          </div>
        </div>
      </div>

      <div class="col-2">
        <label for="taxRate">{{ "EXCLUDE_ITEM" | translate}}</label>
        <label class="form-check form-switch form-check-custom form-check-solid">
          <input type="checkbox" class="form-check-input" [(ngModel)]="item.isExclude">
        </label>
        <label>{{ "PROPERTIES" | translate}}</label>
        <div class="d-flex" *ngFor="let property of item.oArticleGroupMetaData.aProperty; let pIndex = index">
          <div class="w-100">
            <ng-select class="form-control p-0 w-100" [(ngModel)]="selectedProperties[property.iPropertyId]"
              (change)="setPropertyOption(property, pIndex)" [clearable]="false">
              <ng-option *ngFor="let option of propertyOptions[property.iPropertyId]" [value]="option.sCode">{{
                option.sName }}</ng-option>
            </ng-select>
          </div>
        </div>
      </div>
    </section>

    <div class="d-flex">
      <div class="p-2" *ngFor="let image of item.aImage; let i = index" (mouseover)="showDeleteBtn = true"
        (mouseout)="showDeleteBtn = false">
        <div class="image-input" data-kt-image-input="true"
          style="background-image: url('assets/media/svg/avatars/blank.svg')">
          <div class="image-input-wrapper w-125px h-125px"
            style="background-image: url(assets/media/avatars/300-1.jpg)">
            <img src={{image}} width="125px" height="125px">
          </div>

          <div>
            <button class="btn btn-icon btn-circle btn-active-color-primary w-25px h-25px bg-body shadow"
              data-kt-image-input-action="remove" data-bs-toggle="tooltip" title="Remove image"
              (click)="removeImage(i)">
              <i class="bi bi-x fs-2" (click)="removeImage(i)"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
