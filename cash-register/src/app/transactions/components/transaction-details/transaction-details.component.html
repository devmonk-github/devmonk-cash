<div class="card shadow-sm">
    <div class="card-header mt-5">
        <h3>Transaction Details</h3>
        <button type="button" class="btn btn-sm btn-secondary h-50" (click)="close(false)">
            <fa-icon [icon]="faTimes"></fa-icon>
        </button>
    </div>
    <div class="card-body row">
        <div class="col-md-4">
            <h3 class="fw-bolder mb-4">
                <span>{{ "CUSTOMER" | translate }}</span>
            </h3>
            <div class="row fw-bold gy-1">
                <div class="col-md-12">
                    <div class="text-gray-900 mt-2">{{ transaction?.oCustomer?.sFirstName }} {{
                        transaction?.oCustomer?.sPrefix}} {{ transaction?.oCustomer?.sLastName }} </div>
                </div>
                <div class="col-md-6">
                    <div class="mt-2 text-muted">Invoice Address</div>
                    <div class="text-gray-800 mt-2">
                        <span> {{ transaction?.oCustomer?.oInvoiceAddress?.sStreet }} {{
                            transaction?.oCustomer?.oInvoiceAddress?.sHouseNumber }} </span>
                        <span> {{ transaction?.oCustomer?.oInvoiceAddress?.sPostalCode }} {{
                            transaction?.oCustomer?.oInvoiceAddress?.sCity }} </span>
                        <span> {{ transaction?.oCustomer?.oInvoiceAddress?.sCountry }}</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mt-2 text-muted">Shipping Address</div>
                    <div class="text-gray-800 mt-2">
                        <span> {{ transaction?.oCustomer?.oShippingAddress?.sStreet }} {{
                            transaction?.oCustomer?.oShippingAddress?.sHouseNumber }} </span>
                        <span> {{ transaction?.oCustomer?.oShippingAddress?.sPostalCode }} {{
                            transaction?.oCustomer?.oShippingAddress?.sCity }} </span>
                        <span> {{ transaction?.oCustomer?.oShippingAddress?.sCountry }}</span>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="text-gray-800 mt-2">{{ transaction?.oCustomer?.sEmail }}</div>
                    <div class="text-gray-800 mt-2">{{ transaction?.oCustomer?.oPhone?.sMobile }} &nbsp; &nbsp; {{
                        transaction?.oCustomer?.oPhone?.sLandLine }}</div>
                </div>
            </div>
        </div>
        <div class="col-md-8 row" *ngIf="eType === 'cash-register-revenue'">
            <h3 class="fw-bolder mb-4">
                <span>{{ "TRANSACTION_OVERVIEW" | translate }}</span>
            </h3>
            <div class="col-md-8 row fw-bold gy-1">
                <label class="col-md-4 mt-2 text-muted">{{"RECEIPT_NUMBER" | translate}}</label>
                <div class="col-md-8">
                    <div class="text-gray-800 mt-2">{{ transaction.sInvoiceNumber || '' }}</div>
                </div>
                <label class="col-md-4 mt-2 text-muted">{{"DATE_TIME" | translate}}</label>
                <div class="col-md-8">
                    <div class="text-gray-800 mt-2">{{ transaction.dCreatedDate | date: 'short' }}</div>
                </div>
                <label class="col-md-4 mt-2 text-muted">{{"PAY_METHOD" | translate}}</label>
                <div class="col-md-8">
                    <div *ngFor="let payment of transaction.aPayments">
                        <div class="text-gray-800 mt-2">{{ payment.sMethod || '' }}</div>
                    </div>

                </div>
                <label class="col-md-4 mt-2 text-muted">{{"CHANGE" | translate}}</label>
                <div class="col-md-8">
                    <div class="text-gray-800 mt-2">{{ 0 }}</div>
                </div>
                <label class="col-md-4 mt-2 text-muted">{{"REFUNDED" | translate}}</label>
                <div class="col-md-8">
                    <div class="text-gray-800 mt-2">{{ 0 }}</div>
                </div>
                <label class="col-md-4 mt-2 text-muted">{{"ASSISTED_BY" | translate}}</label>
                <div class="col-md-8">
                    <div class="text-gray-800 mt-2">{{ transaction?.oEmployee?.sFirstName }} {{
                        transaction?.oEmployee?.sLastName }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faFileInvoice"></fa-icon>
                    <label class="mx-auto">General Invoice</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex" (click)="downloadWithVAT()">
                    <fa-icon [hidden]="downloadWithVATLoading" [icon]="faDownload"></fa-icon>
                    <i class="fa fa-spinner fa-spin" *ngIf="downloadWithVATLoading" [hidden]="!downloadWithVATLoading"
                        style="font-size:15px;"></i>
                    <label class="mx-auto">Download with VAT</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faDownload"></fa-icon>
                    <label class="mx-auto">Download without VAT</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faReceipt"></fa-icon>
                    <label class="mx-auto">Thermal receipt</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faAt"></fa-icon>
                    <label class="mx-auto">Mail</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex"
                    (click)="openTransaction(transaction, 'transaction')">
                    <fa-icon [icon]="faUndoAlt"></fa-icon>
                    <label class="mx-auto">Refund</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faClipboard"></fa-icon>
                    <label class="mx-auto">View log</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faTrashAlt"></fa-icon>
                    <label class="mx-auto">Delete</label>
                </button>
            </div>
        </div>
        <div class="col-md-8 row" *ngIf="eType === 'webshop-revenue' || eType === 'webshop-reservation'">
            <h3 class="fw-bolder mb-4">
                <span>{{ "OVERVIEW" | translate }}</span>
            </h3>
            <div class="col-md-8 row fw-bold gy-1">
                <div class="col-md-12">
                    <ng-select placeholder="Order status">
                        <ng-option>Status one</ng-option>
                        <ng-option>Status two</ng-option>
                        <ng-option>Status three</ng-option>
                        <ng-option>Status four</ng-option>
                    </ng-select>
                </div>
                <label class="col-md-4 mt-5 text-muted">{{"SHIPPING_METHOD" | translate}} : </label>
                <div class="col-md-8 mt-5">
                    <div class="text-gray-800">Completed</div>
                </div>
                <button class="btn btn-sm btn-primary w-100 d-flex mt-5">
                    <label class="mx-auto">Track and trace the order</label>
                </button>
            </div>
            <div class="col-md-4">
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faDownload"></fa-icon>
                    <label class="mx-auto">Receipt</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <fa-icon [icon]="faReceipt"></fa-icon>
                    <label class="mx-auto">Print thermal</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex">
                    <!-- <fa-icon [icon]="faAt"></fa-icon> -->
                    <label class="mx-auto">Exchange</label>
                </button>
                <button class="btn btn-sm btn-secondary w-100 d-flex" (click)="downloadWebOrder()">
                    <fa-icon [icon]="faDownload"></fa-icon>
                    <label class="mx-auto">Download pdf</label>
                </button>
            </div>
        </div>
    </div>
    <div class="card-body row">
        <div class="col-md-12">
            <h3 class="fw-bolder mb-3">
                <span>{{ "ITEMS" | translate }}</span>
            </h3>
            <div class="row fw-bold gy-1 d-flex flex-wrap py-5">
                <div class="flex-equal me-5">
                    <table class="table table-hover table-rounded table-striped border gy-7 gs-7">
                        <thead>
                            <tr class="fw-bold fs-6 text-gray-400">
                                <td class="text-muted">{{'IMAGE' | translate}}</td>
                                <td class="text-muted">{{'PRODUCT' | translate}}</td>
                                <td class="text-muted">{{'PRICE' | translate}}</td>
                                <td class="text-muted">{{'QUANTITY' | translate}}</td>
                                <td class="text-muted">{{'DISCOUNT_PER_ITEM' | translate}}</td>
                                <td class="text-muted">{{'TAX' | translate}}</td>
                                <td class="text-muted">{{'TOTAL_PRICE' | translate}}</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of transaction.aTransactionItems">
                                <td>
                                    <img src="{{ item.aImage[0] || imagePlaceHolder}}"
                                        (error)="item.aImage[0]=imagePlaceHolder" class="product_image">
                                </td>
                                <td>
                                    <div>
                                        {{item.sProductName}}
                                    </div>
                                    <br>
                                    <div *ngIf="item?.aProductVariant?.length > 0">
                                        <div *ngFor="let variant of item.aProductVariant" class="d-flex">
                                            <div class="w-25">
                                                {{ variant.sVariantBase }}
                                            </div> :
                                            <div class="w-50 px-2">
                                                <span *ngIf="variant.sVariantBase !== 'color'"> {{ variant.value }}
                                                </span>
                                                <span *ngIf="variant.sVariantBase === 'color'"
                                                    [style.background]="variant.value"
                                                    class="px-2 border border-gray-600"></span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td>{{item.nPriceIncVat}}</td>
                                <td>{{item.nQuantity}}</td>
                                <td>{{item.nDiscountToShow}}</td>
                                <td>{{item.nVatRate || 0}} %</td>
                                <td>{{item.totalPriceIncVatAfterDisc || 0}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="d-flex">
                <h5 *ngIf='!transaction?.aTransactionItems?.length && !loading' style="text-align: center;">{{
                    'NO_DATA_FOUND' | translate }}</h5>
                <div *ngIf="loading" class="spinner-border mx-auto"></div>
            </div>
        </div>
    </div>
    <div class="card-footer">
        <button class="btn btn-secondary cancel ml-auto" (click)="close(false)">{{"TEXT_CANCEL" | translate}}</button>
    </div>
</div>
